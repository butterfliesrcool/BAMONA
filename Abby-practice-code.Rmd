---
title: "Abby-practice-code"
author: "Abby Robinson"
date: "7/12/2022"
output: html_document
---
Load Package Libraries
```{r}
library(curl)
library(sf)
library(ggplot2)
library(ggmap)
library(sp)
library(adehabitatHR)
library(cowplot)
library(googleway)
library(ggrepel)
library(ggspatial)
library(rnaturalearth)
library(rnaturalearthdata)
```

Use "curl" command to load and name data files from the GitHub repo for Battus philenor and all mimics 

```{r}
##   battus
b <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/battus_philenor.csv")
battus <- read.csv(b, header = TRUE, sep = ",")
```

```{r}
##   limenitis 
l <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/limenitis_arthemis_astyanax.csv")
limenitis <- read.csv(l, header = TRUE, sep = ",")
```

```{r}
##   glaucus
g <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/papilio_glaucus.csv")
glaucus <- read.csv(g, header = TRUE, sep = ",")
```

```{r}
##   polyxenes
p <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/papilio_polyxenes.csv")
polyxenes <- read.csv(p, header = TRUE, sep = ",")
```

```{r}
##   troilus
t <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/papilio_troilus.csv")
troilus <- read.csv(t, header = TRUE, sep = ",")
```

```{r}
##   diana 
d <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/speyeria.diana.csv")
diana <- read.csv(d, header = TRUE, sep = ",")
```

Clean data: remove NA values, remove all data points that don't include a specimen or photograph, and remove unnecessary data columns 

```{r}
##   battus 

length(battus$Record.Number)
clean.battus <- na.omit(battus)
length(clean.battus$Record.Number)

b <- subset(clean.battus, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
battus <- subset(b, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(battus$Record.Number)
battus
```

```{r}
##limenitis 

length(limenitis$Record.Number)
clean.limenitis <- na.omit(limenitis)
length(clean.limenitis$Record.Number)

l <- subset(clean.limenitis, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
limenitis <- subset(l, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(limenitis$Record.Number)
limenitis
```

```{r}
##   glaucus

length(glaucus$Record.Number)
clean.glaucus <- na.omit(glaucus)
length(clean.glaucus$Record.Number)

g <- subset(clean.glaucus, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
glaucus <- subset(g, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(glaucus$Record.Number)
glaucus
```

```{r}
##   polyxenes

length(polyxenes$Record.Number)
clean.polyxenes <- na.omit(polyxenes)
length(clean.polyxenes$Record.Number)

p <- subset(clean.polyxenes, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
polyxenes <- subset(p, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(polyxenes$Record.Number)
polyxenes
```

```{r}
##   troilus

length(troilus$Record.Number)
clean.troilus <- na.omit(troilus)
length(clean.troilus$Record.Number)

t <- subset(clean.troilus, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
troilus <- subset(t, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(troilus$Record.Number)
troilus
```

```{r}
##   diana 

length(diana$Record.Number)
clean.diana <- na.omit(diana)
length(clean.diana$Record.Number)

diana <- subset(clean.diana, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(diana$Record.Number)
diana
```

Pull out only the mimetic forms for Papilio glaucus and Speyeria diana

```{r}
##   glaucus 

glaucus<- subset(glaucus, Sex == "BF", drop = FALSE)
length(glaucus$Record.Number)
glaucus
```

```{r}
## diana 

diana <- subset(diana, sex == "F", drop = FALSE)
length(diana$Record.Number)
diana
```

final sample sizes after data cleaning 
- battus: 1282
- limenitis: 1700
- glaucus: 695
- polyxenes: 2798
- troilus: 1822
- diana: 70



```{r}
battus <- subset(battus, select = c(Scientific.Name, Lat.Long, Longitude) )
limenitis <- subset(limenitis, select = c(Scientific.Name, Lat.Long, Longitude) )
glaucus <- subset(glaucus, select = c(Scientific.Name, Lat.Long, Longitude) )
polyxenes <- subset(polyxenes, select = c(Scientific.Name, Lat.Long, Longitude) )
troilus <- subset(troilus, select = c(Scientific.Name, Lat.Long, Longitude) )
diana <- subset(diana, select = c(Scientific.Name, Lat.Long, Longitude) )


all.data <- rbind(battus, limenitis, glaucus, polyxenes, troilus, diana)

colnames(all.data)[2] <- "Latitude"

all.data
```








Notes for Google API code: 


# Google is weird in that their 'bounding box' (coordinates that set the
# boundary of the image we download) is in a fixed coordinate system, so we
# need to define a function to fix the 'bounding box' to be in our actual
# data projection of EPSG:32718:
ggmap_bbox <- function(map) {
    if (!inherits(map, "ggmap")) 
        stop("map must be a ggmap object")
    # Extract the bounding box (in lat/lon) from the ggmap to a numeric vector,
    # and set the names to what sf::st_bbox expects:
    map_bbox <- setNames(unlist(attr(map, "bb")), c("ymin", "xmin", "ymax", 
        "xmax"))
    
    # Coonvert the bbox to an sf polygon, transform it to 32718, and convert
    # back to a bbox (convoluted, but it works)
    bbox_32718 <- st_bbox(st_transform(st_as_sfc(st_bbox(map_bbox, crs = 4326)), 
        32718))
    
    # Overwrite the bbox of the ggmap object with the transformed coordinates
    attr(map, "bb")$ll.lat <- bbox_32718["ymin"]
    attr(map, "bb")$ll.lon <- bbox_32718["xmin"]
    attr(map, "bb")$ur.lat <- bbox_32718["ymax"]
    attr(map, "bb")$ur.lon <- bbox_32718["xmax"]
    map
}

# Use the function to change the coordinate system of the bounding box:
map <- ggmap_bbox(map)

p <- ggmap(map) + coord_sf(xlim = c(-76.18, -76.13), ylim = c(-0.63, -0.66), 
    crs = st_crs(32718)) + geom_sf(data = tbs_trails, inherit.aes = FALSE) + 
    geom_sf(data = tbs_rio, color = "dodgerblue", inherit.aes = FALSE) + geom_sf(data = d, 
    color = "light pink", alpha = 0.5, inherit.aes = FALSE)




```{r}
## heat map 
battus_k100 <- kernelUD(battus.sp)
image(battus_k100)
```