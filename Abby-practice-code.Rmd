---
title: "Abby-practice-code"
author: "Abby Robinson"
date: "7/12/2022"
output: html_document
---
Load Package Libraries
```{r}
library(curl)
library(sf)
library(ggplot2)
library(ggmap)
library(sp)
library(adehabitatHR)
library(cowplot)
library(googleway)
library(ggrepel)
library(ggspatial)
library(rnaturalearth)
library(rnaturalearthdata)
```

Use "curl" command to load and name data files from the GitHub repo for Battus philenor and all mimics 

```{r}
##   battus
b <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/battus_philenor.csv")
battus <- read.csv(b, header = TRUE, sep = ",")
```

```{r}
##   limenitis 
l <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/limenitis_arthemis_astyanax.csv")
limenitis <- read.csv(l, header = TRUE, sep = ",")
```

```{r}
##   glaucus
g <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/papilio_glaucus.csv")
glaucus <- read.csv(g, header = TRUE, sep = ",")
```

```{r}
##   polyxenes
p <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/papilio_polyxenes.csv")
polyxenes <- read.csv(p, header = TRUE, sep = ",")
```

```{r}
##   troilus
t <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/papilio_troilus.csv")
troilus <- read.csv(t, header = TRUE, sep = ",")
```

```{r}
##   diana 
d <- curl("https://raw.githubusercontent.com/butterfliesrcool/BAMONA/main/speyeria.diana.csv")
diana <- read.csv(d, header = TRUE, sep = ",")
```

Clean data: remove NA values, remove all data points that don't include a specimen or photograph, and remove unnecessary data columns 

```{r}
##   battus 

length(battus$Record.Number)
clean.battus <- na.omit(battus)
length(clean.battus$Record.Number)

b <- subset(clean.battus, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
battus <- subset(b, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(battus$Record.Number)
battus
```

```{r}
##limenitis 

length(limenitis$Record.Number)
clean.limenitis <- na.omit(limenitis)
length(clean.limenitis$Record.Number)

l <- subset(clean.limenitis, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
limenitis <- subset(l, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(limenitis$Record.Number)
limenitis
```

```{r}
##   glaucus

length(glaucus$Record.Number)
clean.glaucus <- na.omit(glaucus)
length(clean.glaucus$Record.Number)

g <- subset(clean.glaucus, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
glaucus <- subset(g, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(glaucus$Record.Number)
glaucus
```

```{r}
##   polyxenes

length(polyxenes$Record.Number)
clean.polyxenes <- na.omit(polyxenes)
length(clean.polyxenes$Record.Number)

p <- subset(clean.polyxenes, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
polyxenes <- subset(p, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(polyxenes$Record.Number)
polyxenes
```

```{r}
##   troilus

length(troilus$Record.Number)
clean.troilus <- na.omit(troilus)
length(clean.troilus$Record.Number)

t <- subset(clean.troilus, select = -c(Organism.Type,Location.Notes, Observation.Notes, Updated.Date, Partner.Project, Data.Source, Submitter ) )
troilus <- subset(t, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(troilus$Record.Number)
troilus
```

```{r}
##   diana 

length(diana$Record.Number)
clean.diana <- na.omit(diana)
length(clean.diana$Record.Number)

diana <- subset(clean.diana, Specimen.Type %in% c("Specimen", "Photograph"), drop = FALSE)
length(diana$Record.Number)
diana
```

Pull out only the mimetic forms for Papilio glaucus and Speyeria diana

```{r}
##   glaucus 

glaucus<- subset(glaucus, Sex == "BF", drop = FALSE)
length(glaucus$Record.Number)
glaucus
```

```{r}
## diana 

diana <- subset(diana, sex == "F", drop = FALSE)
length(diana$Record.Number)
diana
```

final sample sizes after data cleaning 
- battus: 1282
- limenitis: 1700
- glaucus: 695
- polyxenes: 2798
- troilus: 1822
- diana: 70



```{r}
battus <- subset(battus, select = c(Scientific.Name, Lat.Long, Longitude) )
limenitis <- subset(limenitis, select = c(Scientific.Name, Lat.Long, Longitude) )
glaucus <- subset(glaucus, select = c(Scientific.Name, Lat.Long, Longitude) )
polyxenes <- subset(polyxenes, select = c(Scientific.Name, Lat.Long, Longitude) )
troilus <- subset(troilus, select = c(Scientific.Name, Lat.Long, Longitude) )
diana <- subset(diana, select = c(Scientific.Name, Lat.Long, Longitude) )


row.all.data <- rbind(battus, limenitis, glaucus, polyxenes, troilus, diana)

colnames(row.all.data)[2] <- "Latitude"

row.all.data
```

```{r}
plot(row.all.data$Longitude, row.all.data$Latitude)

ggplot(row.all.data,aes(x=Longitude,y=Latitude,col=Scientific.Name))+geom_point()
```



```{r}
library(spatstat)
```

[5] Linking in Google Maps API key
```{r}
library("rstudioapi")
library("ggmap")
register_google(key = "")
```

[6] Generate heat maps for all species
```{r}
battus_heatmap <- ggmap(get_googlemap(center = c(lon = -79.74658480805773, lat = 37.20888926712938),
                                  zoom = 4,scale = 2,
                                  maptype = 'terrain',
                                  color = 'color'))+
  stat_density2d(aes(x = Longitude, y = Lat.Long, fill = ..level..),
                 alpha = .2,
                 bins = 15, data = battus, geom = "polygon") +
  labs(fill="B. philenor
Population Density") +
  scale_fill_viridis_c(option = "plasma")

battus_heatmap
```

```{r}
limenitis_heatmap <- ggmap(get_googlemap(center = c(lon = -79.74658480805773, lat = 37.20888926712938),
                                  zoom = 4,scale = 2,
                                  maptype = 'terrain',
                                  color = 'color'))+
  stat_density2d(aes(x = Longitude, y = Lat.Long, fill = ..level..),
                 alpha = .2,
                 bins = 15, data = limenitis, geom = "polygon") +
  labs(fill="L. arthemis astyanax
Population Density") +
  scale_fill_viridis_c(option = "plasma")

limenitis_heatmap
```

```{r}
glaucus_heatmap <- ggmap(get_googlemap(center = c(lon = -79.74658480805773, lat = 37.20888926712938),
                                  zoom = 4,scale = 2,
                                  maptype = 'terrain',
                                  color = 'color'))+
  stat_density2d(aes(x = Longitude, y = Lat.Long, fill = ..level..),
                 alpha = .2,
                 bins = 15, data = glaucus, geom = "polygon") +
  labs(fill="P. glaucus
Population Density") +
  scale_fill_viridis_c(option = "plasma")

glaucus_heatmap
```

```{r}
polyxenes_heatmap <- ggmap(get_googlemap(center = c(lon = -79.74658480805773, lat = 37.20888926712938),
                                  zoom = 4,scale = 2,
                                  maptype = 'terrain',
                                  color = 'color'))+
  stat_density2d(aes(x = Longitude, y = Lat.Long, fill = ..level..),
                 alpha = .2,
                 bins = 15, data = polyxenes, geom = "polygon") +
  labs(fill="P. polyxenes
Population Density") +
  scale_fill_viridis_c(option = "plasma")

polyxenes_heatmap
```

```{r}
troilus_heatmap <- ggmap(get_googlemap(center = c(lon = -79.74658480805773, lat = 37.20888926712938),
                                  zoom = 4,scale = 2,
                                  maptype = 'terrain',
                                  color = 'color'))+
  stat_density2d(aes(x = Longitude, y = Lat.Long, fill = ..level..),
                 alpha = .2,
                 bins = 15, data = troilus, geom = "polygon") +
  labs(fill="P. troilus
Population Density") +
  scale_fill_viridis_c(option = "plasma")

troilus_heatmap
```

```{r}
diana_heatmap <- ggmap(get_googlemap(center = c(lon = -79.74658480805773, lat = 37.20888926712938),
                                  zoom = 4,scale = 2,
                                  maptype = 'terrain',
                                  color = 'color'))+
  stat_density2d(aes(x = Longitude, y = Lat.Long, fill = ..level..),
                 alpha = .2,
                 bins = 15, data = diana, geom = "polygon") +
  labs(fill="B. philenor
Population Density") +
  scale_fill_viridis_c(option = "plasma")

diana_heatmap
```
[1] Load package libraries
```{r}
library(curl)
library(sf)
library(ggplot2)
library(ggmap)
library(sp)
library(adehabitatHR) ##kernel density package 
library(cowplot)
library(googleway)
library(ggrepel)
library(ggspatial)
library(rnaturalearth)
library(rnaturalearthdata)
library("tidyverse")
library("maps")
library("mapproj") #using this to create a projection using a coordinate system (map will appear curved, reflective of the Earth's curvature)
library("magrittr")
library("ggplot2")
library(raster)
library(rgdal)
library(spatialEco)
library(Spatial)
library(raster)
```

[7] Make a raster from ggplot image/heatmap
```{r}
# You may need to remove the margins from the plot (i.e., keep the earth raster and the routes only)
plot <- battus_heatmap+ 
  theme(    
        axis.ticks=element_blank(), 
        axis.text.x=element_blank(), 
        axis.text.y=element_blank(), 
        axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.margin = unit(c(0, 0, 0, 0), "null"),
        legend.position = 'none'
       ) +
       labs(x=NULL, y=NULL)

# Save the plot
ggsave(plot=plot, "battus_heatmap.tiff", device = "tiff")

# Create a StackedRaster object from the saved plot
battus_raster <- raster("battus_heatmap.tiff") # OR stack("my_ggplot.tiff") for colored images

# Get the GeoSpatial Components
bat_lat_long <- ggplot_build(plot)$layout$panel_params[[1]][c("x.range","y.range")] 

# Supply GeoSpatial  data to the StackedRaster 
extent(battus_raster) <- c(bat_lat_long$x.range,bat_lat_long$y.range)
projection(battus_raster) <- CRS("+proj=longlat +datum=WGS84")

battus_raster
plot(battus_raster)
```

[8] Find Pearson's correlation coefficient between two rasters - I have not worked this out yet. Here is a sample script I pulled from Stack Exchange. (It just makes a raster of the R logo.)
```{r}
b <- brick(system.file("external/rlogo.grd", package="raster"))
x <- b[[1]]
y <- b[[3]]
r.cor <- rasterCorrelation(x, y, s = 5, type = "pearson") # you can also use Spearman correlation

#This plots the raster. Not sure how to get it to show me Pearson's correlation coefficient...
#plot(r.cor)

r.cor
```

[9] Other option: raster modified t-test (another fxn in the SpatialEco package)
```{r}
raster.modified.ttest()
```

```{r}
## heat map 
battus_k100 <- kernelUD(battus.sp)
image(battus_k100)
```

NOTES: 
* Pearson's correlation coefficient in SpatialEco Package 
* make heat map that does not include google map 